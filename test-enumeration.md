THIS IS AUTOGENERATED DOCUMENT

# OSW Data Service Unit Test Cases

## Purpose


This document details the unit test cases for the [OSW Data Service](https://github.com/TaskarCenterAtUW/TDEI-osw-datasvc-ts)

------------

## Test Framework

Unit test cases are to be written using [Jest](https://jestjs.io/ "Jest")

------------

### Jest code pattern

```javascript
    describe("User Controller", () => {
        describe("Get List", () => {
            describe("Functional", () => {
                const getTestData => return {};
                it('{{Scenario}}, {{Expectation}}', () => {
                    //Arrange
                    let testData = getTestData();
                    let controller = new controller();
                    //Act
                    const result = controller.getVersions();
                    //Assert
                    expect(result.status).toBe(200);
                    expect(result.myAwesomeField).toBe('valid');
                });
            });
        });
    });
```

------------

## Test Cases

|Feature Under Test | Test Case Description | Status |
|-------------------------------------------------------------------------------------|---------|---------------|
| Health Check | When requested for health check, Expect to returns http status 200 if healthy | passed |
| Metadata JSON Validator | should call next() if metadata file is present and valid JSON | passed |
| Metadata JSON Validator | should throw InputException if metadata file is missing | passed |
| Metadata JSON Validator | should throw InputException if metadata file contains invalid JSON | passed |
| Metadata JSON Validator | should handle general errors by throwing InputException with a default message | passed |
| Authenticate | should call next() and set user_id if authorization header is valid | passed |
| Authenticate | should call next() with UnAuthenticated error if authorization header is missing | passed |
| Authenticate | should call next() with UnAuthenticated error if authorization header is empty | passed |
| Authenticate | should call next() with UnAuthenticated error if bearer is missing | passed |
| Authenticate | should call next() with UnAuthenticated error if jwt.decode returns null | passed |
| Authorize Middleware | should call next() if user_id is missing | passed |
| Authorize Middleware | should set tdei_project_group_id from tdei_record_id | passed |
| Authorize Middleware | should set tdei_project_group_id from params if tdei_record_id is missing | passed |
| Authorize Middleware | should call next() with UnAuthenticated error if roles are not approved | passed |
| OSW Controller Test -> Get OSW list -> Functional | When requested with empty search criteria, Expect to return OSW list | passed |
| OSW Controller Test -> Get OSW list -> Functional | When requested with bad collection_date input, Expect to return HTTP status 400 | passed |
| OSW Controller Test -> Get OSW list -> Functional | When unknown or database exception occured while processing request, Expect to return HTTP status 500 | passed |
| OSW Controller Test -> Get OSW file by Id -> Functional | When requested for valid tdei_record_id, Expect to return downloadable file stream | passed |
| OSW Controller Test -> Get OSW file by Id -> Functional | When requested for invalid tdei_record_id, Expect to return HTTP status 404 | passed |
| OSW Controller Test -> Get OSW file by Id -> Functional | When unexpected error occured while processing request, Expect to return HTTP status 500 | passed |
| OSW Controller Test -> Get Version list -> Functional | When requested version info, Expect to return HTTP status 200 | passed |
| OSW Controller Test -> process upload request | should process the upload request and return tdei_record_id | passed |
| OSW Controller Test -> process upload request | should handle missing dataset file | passed |
| OSW Controller Test -> process upload request | should handle missing metadata file | passed |
| OSW Controller Test -> process upload request | should handle internal server error | passed |
| OSW Controller Test -> process publish request | should process the publish request and return tdei_record_id | passed |
| OSW Controller Test -> process publish request | should handle internal server error | passed |
| OSW Controller Test -> process validation only request | should process the validation request and return job_id | passed |
| OSW Controller Test -> process validation only request | should handle validation request with missing dataset file | passed |
| OSW Controller Test -> process validation only request | should handle internal server error | passed |
| OSW Controller Test -> calculate confidence metric | should calculate confidence and return job_id | passed |
| OSW Controller Test -> calculate confidence metric | should handle calculate confidence request with missing tdei_record_id | passed |
| OSW Controller Test -> calculate confidence metric | should handle internal server error | passed |
| OSW Controller Test -> get confidence job status | should return confidence job status | passed |
| OSW Controller Test -> get confidence job status | should handle error during confidence job status retrieval | passed |
| OSW Controller Test -> create format request | should create format request and return job_id | passed |
| OSW Controller Test -> create format request | should handle missing upload file input | passed |
| OSW Controller Test -> create format request | should handle error during format request processing | passed |
| OSW Controller Test -> Invalidate the record | When requested to invalidate a record, Expect to return http status 200 and true if successful | passed |
| OSW Controller Test -> Invalidate the record | When an error occurs while processing the invalidate request, Expect to return http status 500 and error message | passed |
| OSW Controller Test -> Invalidate the record | When an HttpException occurs while processing the invalidate request, Expect to return corresponding http status and error message | passed |
| OSW Controller Test -> Download the file after formatting getFormatDownloadFile | should throw jobId not found if not found | passed |
| OSW Controller Test -> Download the file after formatting getFormatDownloadFile | should throw job incomplete if the status is not completed | passed |
| OSW Controller Test -> Download the file after formatting getFormatDownloadFile | should send 400 error if the format is not the right one | passed |
| OSW Controller Test -> Download the file after formatting getFormatDownloadFile | should throw input exception if job_id is not given | passed |
| OSW Integration Test | Verifying auth service hasPermission api integration | passed |
| OSW Integration Test | Verifying auth service generate secret api integration | passed |
| OSW Service Test -> Get all OSW -> Functional | When requested with empty search filters, Expect to return OSW list | passed |
| OSW Service Test -> Get all OSW -> Functional | When requested with all search filters, expect to return OSW list | passed |
| OSW Service Test -> Get all OSW -> Functional | When requested with invalid date search filter, Expect to throw InputException | passed |
| OSW Service Test -> Get all OSW -> Functional | When requested with invalid bbox search filter, Expect to throw InputException | passed |
| OSW Service Test -> Get all OSW -> Functional | When requested for 'Pre-Release' records and user not associsted with any project groups, Expect to throw InputException | passed |
| OSW Service Test -> Get all OSW -> Functional | When requested for 'Pre-Release' records and user associsted with any project groups, Expect to return OSW list | passed |
| OSW Service Test -> Get OSW file by Id -> Functional | When requested for get OSW file by tdei_record_id, Expect to return FileEntity object | passed |
| OSW Service Test -> Get OSW file by Id -> Functional | When requested for get OSW file by tdei_record_id and osm format, Expect to return FileEntity object | passed |
| OSW Service Test -> Get OSW file by Id -> Functional | When requested for get OSW file by tdei_record_id and xml format, Expect to return FileEntity object | passed |
| OSW Service Test -> Get OSW file by Id -> Functional | When requested for get OSW file where conversion for osm for tdei_record_id not available, Expect to throw HttpException | passed |
| OSW Service Test -> Get OSW file by Id -> Functional | When requested for get OSW file with invalid tdei_record_id, Expect to throw HttpException | passed |
| OSW Service Test -> Get OSW file by Id -> Functional | When Core failed obtaing storage client, Expect to throw error | passed |
| OSW Service Test -> Create OSW version -> Functional | When requested for creating OSW version with valid input, Expect to return OswDTO object | passed |
| OSW Service Test -> Create OSW version -> Functional | When database exception with duplicate tdei_record_id occured while processing request, Expect to throw DuplicateException | passed |
| OSW Service Test -> Create OSW version -> Functional | When database exception occured while processing request, Expect to throw error | passed |
| OSW Service Test -> Create OSW metadata -> Functional | When requested for creating OSW metadata with valid input, Expect to return OswDTO object | passed |
| OSW Service Test -> Create OSW metadata -> Functional | When database exception with duplicate tdei_record_id occured while processing request, Expect to throw DuplicateException | passed |
| OSW Service Test -> Create OSW metadata -> Functional | When database exception occured while processing request, Expect to throw error | passed |
| OSW Service Test -> get OSW record by Id | should resolve with the record if it exists | passed |
| OSW Service Test -> get OSW record by Id | should throw HttpException with 404 status if the record does not exist | passed |
| OSW Service Test -> get OSW metadata by Id | should resolve with the record if it exists | passed |
| OSW Service Test -> get OSW metadata by Id | should throw HttpException with 404 status if the record does not exist | passed |
| OSW Service Test -> create OSW confidence job | should resolve with the inserted job ID | passed |
| OSW Service Test -> create OSW confidence job | should reject with the original error if an error occurs during insertion | passed |
| OSW Service Test -> get OSW confidence job | should resolve with the job if the job ID is found | passed |
| OSW Service Test -> get OSW confidence job | should reject with JobIdNotFoundException if the job ID is not found | passed |
| OSW Service Test -> get OSW confidence job | should reject with the original error if an error occurs during the query | passed |
| OSW Service Test -> create OSW format job | should resolve with the created job ID if the insertion is successful | passed |
| OSW Service Test -> create OSW format job | should reject with an error if the job ID is not found in the query result | passed |
| OSW Service Test -> create OSW format job | should reject with the original error if an error occurs during insertion | passed |
| OSW Service Test -> get OSW format job | should resolve with the job if the job ID is found | passed |
| OSW Service Test -> get OSW format job | should reject with JobIdNotFoundException if the job ID is not found | passed |
| OSW Service Test -> get OSW format job | should reject with the original error if an error occurs during the query | passed |
| OSW Service Test -> update OSW format job | should not throw error if rows are updated | passed |
| OSW Service Test -> update OSW format job | should throw an error if no rows are updated | passed |
| OSW Service Test -> update OSW format job | should reject with the original error if an error occurs during the update | passed |
| OSW Service Test -> get OSW validation job | should resolve with the job if the job ID is found | passed |
| OSW Service Test -> get OSW validation job | should reject with JobIdNotFoundException if the job ID is not found | passed |
| OSW Service Test -> get OSW validation job | should reject with the original error if an error occurs during the query | passed |
| OSW Service Test -> update confidence metric | should update status and return jobId if rows are updated | passed |
| OSW Service Test -> update confidence metric | should throw an error if no rows are updated during status update | passed |
| OSW Service Test -> update confidence metric | should reject with the original error if an error occurs during the status update | passed |
| OSW Service Test -> check metadata name And version unique | should resolve with true if record with the same name and version exists | passed |
| OSW Service Test -> check metadata name And version unique | should resolve with false if no record with the same name and version exists | passed |
| OSW Service Test -> check metadata name And version unique | should resolve with true if an error occurs during the query | passed |
| OSW Service Test -> process format request | should process the format request and return jobId | passed |
| OSW Service Test -> calculate confidence metric | should calculate confidence successfully | passed |
| OSW Service Test -> process validation only request | should process validation request successfully | passed |
| OSW Service Test -> process publish request | should process publish request successfully | passed |
| OSW Service Test -> process upload request | should process upload request successfully | passed |
| OSW Service Test -> process upload request | should throw ServiceNotFoundException if service id not found | passed |
| OSW Service Test -> process upload request | should throw InputException if metadata name and version not unique | passed |
| OSW Service Test -> get service by Id | should get service by ID successfully | passed |
| OSW Service Test -> get service by Id | should handle error during fetch | passed |
| OSW Service Test -> get user project groups | should get service by ID successfully | passed |
| OSW Service Test -> get user project groups | should handle error during fetch | passed |
| OSW Service Test -> Invalidate Record Request | should invalidate the record and return true if query result has rowCount > 0 | passed |
| OSW Service Test -> Invalidate Record Request | should not invalidate the record and return false if query result has rowCount <= 0 | passed |
| OSW Service Test -> Invalidate Record Request | should throw an error if an error occurs while invalidating the record | passed |